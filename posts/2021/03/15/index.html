<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>用 Vim 搭建开发环境 - 孔俊的知识库</title><meta name=author content><meta name=author-link content><meta name=description content="刚接触 Vim 的同学往往因为无法搭建开发环境而“从入门到放弃”，本文旨在帮助这些同学搭建开发环境，聚焦于最核心的开发需求，忽略换配色调字体之类的细枝末节。如果需要开箱即用的 vim 配置（发行版），可以使用 Spacevim。 本文使用 neovim-nightly，但也适用于 Vim 8.2+，不需要读者有任何 VimL 基础，以 C/C++ 为例，但应该适用于任何语言。 插件管理 在 Vim 中，插件只是一些脚本，"><meta name=keywords content="Vim"><meta itemprop=name content="用 Vim 搭建开发环境"><meta itemprop=description content="刚接触 Vim 的同学往往因为无法搭建开发环境而“从入门到放弃”，本文旨在帮助这些同学搭建开发环境，聚焦于最核心的开发需求，忽略换配色调字体之类的细枝末节。如果需要开箱即用的 vim 配置（发行版），可以使用 Spacevim。 本文使用 neovim-nightly，但也适用于 Vim 8.2+，不需要读者有任何 VimL 基础，以 C/C++ 为例，但应该适用于任何语言。 插件管理 在 Vim 中，插件只是一些脚本，"><meta itemprop=datePublished content="2021-03-15T14:53:02+08:00"><meta itemprop=dateModified content="2021-03-15T14:53:02+08:00"><meta itemprop=wordCount content="6050"><meta itemprop=image content="/posts/2021/03/15/images/featured-image.webp"><meta itemprop=keywords content="Vim,"><meta property="og:title" content="用 Vim 搭建开发环境"><meta property="og:description" content="刚接触 Vim 的同学往往因为无法搭建开发环境而“从入门到放弃”，本文旨在帮助这些同学搭建开发环境，聚焦于最核心的开发需求，忽略换配色调字体之类的细枝末节。如果需要开箱即用的 vim 配置（发行版），可以使用 Spacevim。 本文使用 neovim-nightly，但也适用于 Vim 8.2+，不需要读者有任何 VimL 基础，以 C/C++ 为例，但应该适用于任何语言。 插件管理 在 Vim 中，插件只是一些脚本，"><meta property="og:type" content="article"><meta property="og:url" content="/posts/2021/03/15/"><meta property="og:image" content="/posts/2021/03/15/images/featured-image.webp"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-03-15T14:53:02+08:00"><meta property="article:modified_time" content="2021-03-15T14:53:02+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/posts/2021/03/15/images/featured-image.webp"><meta name=twitter:title content="用 Vim 搭建开发环境"><meta name=twitter:description content="刚接触 Vim 的同学往往因为无法搭建开发环境而“从入门到放弃”，本文旨在帮助这些同学搭建开发环境，聚焦于最核心的开发需求，忽略换配色调字体之类的细枝末节。如果需要开箱即用的 vim 配置（发行版），可以使用 Spacevim。 本文使用 neovim-nightly，但也适用于 Vim 8.2+，不需要读者有任何 VimL 基础，以 C/C++ 为例，但应该适用于任何语言。 插件管理 在 Vim 中，插件只是一些脚本，"><meta name=application-name content="FixIt"><meta name=apple-mobile-web-app-title content="FixIt"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical href=/posts/2021/03/15/><link rel=prev href=/posts/2020/05/05/><link rel=next href=/posts/2021/04/28/><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"用 Vim 搭建开发环境","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"\/posts\/2021\/03\/15\/"},"image":[{"@type":"ImageObject","url":"\/posts\/2021\/03\/15\/images\/featured-image.webp","width":1431,"height":836}],"genre":"posts","keywords":"Vim","wordcount":6050,"url":"\/posts\/2021\/03\/15\/","datePublished":"2021-03-15T14:53:02+08:00","dateModified":"2021-03-15T14:53:02+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"孔俊"},"description":""}</script></head><body data-header-desktop=sticky data-header-mobile=auto><script>(window.localStorage?.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("data-theme","dark")</script><div class=wrapper data-page-style=normal><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper data-github-corner=left><div class=header-title><a href=/ title=孔俊的知识库><img loading=lazy src=/logo.svg srcset="/logo.svg, /logo.svg 1.5x, /logo.svg 2x" sizes=auto data-title=孔俊的知识库 data-alt=孔俊的知识库 class=logo style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span class=header-title-text>孔俊的知识库</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/posts/>文章</a></li><li class=menu-item><a class=menu-link href=/categories/>分类</a></li><li class=menu-item><a class=menu-link href=/tags/>标签</a></li><li class=menu-item><a class=menu-link href=/archives/>归档</a></li><li class=menu-item><a class=menu-link href=/about/>关于我</a></li><li class="menu-item delimiter"></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=孔俊的知识库><img loading=lazy src=/logo.svg srcset="/logo.svg, /logo.svg 1.5x, /logo.svg 2x" sizes=auto data-title=/logo.svg data-alt=/logo.svg class=logo style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span class=header-title-text>孔俊的知识库</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=menu-item><a class=menu-link href=/posts/>文章</a></li><li class=menu-item><a class=menu-link href=/categories/>分类</a></li><li class=menu-item><a class=menu-link href=/tags/>标签</a></li><li class=menu-item><a class=menu-link href=/archives/>归档</a></li><li class=menu-item><a class=menu-link href=/about/>关于我</a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span></li></ul></nav></div></header><main class=container><aside class=toc id=toc-auto><h2 class=toc-title>目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside><aside class=aside-custom></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span title=转载 class=icon-repost><i class="fa-solid fa-share fa-fw" aria-hidden=true></i></span><span>用 Vim 搭建开发环境</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><span class=author><i class="fa-solid fa-user-circle" aria-hidden=true></i>
孔俊</span></span>
<span class=post-category>收录于 <a href=/categories/vim/><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> Vim</a></span></div><div class=post-meta-line><span title="发布于 2021-03-15 14:53:02"><i class="fa-regular fa-calendar-alt fa-fw me-1" aria-hidden=true></i><time datetime=2021-03-15>2021-03-15</time></span>&nbsp;<span title="更新于 2021-03-15 14:53:02"><i class="fa-regular fa-edit fa-fw me-1" aria-hidden=true></i><time datetime=2021-03-15>2021-03-15</time></span>&nbsp;<span><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>约 6050 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>预计阅读 13 分钟</span>&nbsp;</div></div><div class=featured-image><img loading=lazy src=/posts/2021/03/15/images/featured-image.webp srcset="/posts/2021/03/15/images/featured-image.webp, /posts/2021/03/15/images/featured-image.webp 1.5x, /posts/2021/03/15/images/featured-image.webp 2x" sizes=auto data-title=/posts/2021/03/15/images/featured-image.webp data-alt=/posts/2021/03/15/images/featured-image.webp style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#插件管理>插件管理</a></li><li><a href=#代码补全>代码补全</a></li><li><a href=#错误检查>错误检查</a></li><li><a href=#符号索引>符号索引</a></li><li><a href=#任务系统>任务系统</a></li><li><a href=#语法高亮>语法高亮</a></li><li><a href=#文件操作>文件操作</a></li><li><a href=#调试>调试</a></li><li><a href=#git>Git</a></li><li><a href=#格式化>格式化</a></li><li><a href=#注释>注释</a></li><li><a href=#结语>结语</a></li></ul></nav></div></div><div class=content id=content><p>刚接触 Vim 的同学往往因为无法搭建开发环境而“从入门到放弃”，本文旨在帮助这些同学搭建开发环境，聚焦于最核心的开发需求，忽略换配色调字体之类的细枝末节。如果需要开箱即用的 vim 配置（发行版），可以使用 <a href=https://github.com/SpaceVim/SpaceVim target=_blank rel="external nofollow noopener noreferrer">Spacevim<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>。</p><p>本文使用 neovim-nightly，但也适用于 Vim 8.2+，不需要读者有任何 VimL 基础，以 C/C++ 为例，但应该适用于任何语言。</p><h2 id=插件管理>插件管理</h2><p>在 Vim 中，插件只是一些脚本，存放在特定的目录中，运行时将它们所在的目录加入到 runtimepath 中。Vim 8 内置了插件管理功能，但不支持高级的插件管理功能。Vimmers 实现了多个插件管理器，可以自动下载、更新、安装插件，还可以延迟加载、按需加载，提高启动速度。</p><p>上古时期流行手动或使用 <a href=https://github.com/VundleVim/Vundle.vim target=_blank rel="external nofollow noopener noreferrer">Vundle<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a> 管理插件，以上两种方式已经落伍了，这里介绍目前比较流行的三个插件管理器：</p><ul><li><a href=https://github.com/junegunn/vim-plug target=_blank rel="external nofollow noopener noreferrer">vim-plug<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>：简单易用高效，是目前最流行的插件管理器</li><li><a href=https://github.com/Shougo/dein.vim target=_blank rel="external nofollow noopener noreferrer">dein.vim<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>：功能强大，但使用复杂</li><li><a href=https://github.com/tpope/vim-pathogen target=_blank rel="external nofollow noopener noreferrer">vim-pathogen<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>：另一款流行的插件管理器，没有用过不做评价</li></ul><p>以上三款插件管理器风格各不相同，都有大量用户，功能相当完善，根据自己的喜好选取即可。推荐新手选择 vim-plug，对启动时间特别敏感的同学可以考虑 dein.vim，我的配置在安装 70 余个插件的情况下，启动仅需 60 余秒。</p><p>使用 vim-plug 安装插件只需要在 .vimrc 中写入以下代码：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-vim data-lang=vim><span class=line><span class=cl><span class=nx>call</span> <span class=nx>plug</span>#<span class=nx>begin</span><span class=p>(</span><span class=s1>&#39;~/.vim/plugged&#39;</span><span class=p>)</span> <span class=c>&#34; 括号里面是插件目录</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>                                  &#34; 只能在 plug#begin() 和 plug#end() 之间写安装插件的命令</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>Plug</span> <span class=s1>&#39;junegunn/vim-easy-align&#39;</span>    <span class=c>&#34; 用户名/插件名，默认从 github 下载安装</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>Plug</span> <span class=s1>&#39;https://github.com/junegunn/vim-github-dashboard.git&#39;</span> <span class=c>&#34; 从特定 URL 下载安装</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>call</span> <span class=nx>plug</span>#<span class=nx>end</span><span class=p>()</span><span class=err>
</span></span></span></code></pre></div><p>使用 dein.vim 安装插件：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-vim data-lang=vim><span class=line><span class=cl><span class=nx>set</span> <span class=nx>runtimepath</span><span class=p>+=~</span><span class=sr>/.vim/</span><span class=nx>plugged</span><span class=sr>/repos/</span><span class=nx>github</span>.<span class=nx>com</span><span class=sr>/Shougo/</span><span class=nx>dein</span>.<span class=nx>vim</span> <span class=c>&#34; 将 dein.vim 添加到 runtimepath</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>                                                                 &#34; 注意这是 Ex 命令，路径不要加引号</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>if</span> <span class=nx>dein</span>#<span class=nx>load_state</span><span class=p>(</span><span class=s1>&#39;~/.vim/plugged&#39;</span><span class=p>)</span>        <span class=c>&#34; 参数是插件目录</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=nx>call</span> <span class=nx>dein</span>#<span class=nx>begin</span><span class=p>(</span><span class=nx>general</span>#<span class=nx>plugin_dir</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=nx>call</span> <span class=nx>dein</span>#<span class=nx>add</span><span class=p>(</span><span class=s1>&#39;~/.vim/plugged/repos/github.com/Shougo/dein.vim&#39;</span><span class=p>)</span>  <span class=c>&#34; 安装 dein.vim</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=nx>call</span> <span class=nx>dein</span>#<span class=nx>add</span><span class=p>(</span><span class=s1>&#39;junegunn/vim-easy-align&#39;</span><span class=p>)</span> <span class=c>&#34; 用户名/插件名，默认从 github 下载安装</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=nx>call</span> <span class=nx>dein</span>#<span class=nx>end</span><span class=p>()</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=nx>call</span> <span class=nx>dein</span>#<span class=nx>save_state</span><span class=p>()</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>endif</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>if</span> <span class=nx>dein</span>#<span class=nx>check_install</span><span class=p>()</span> <span class=c>&#34; 自动安装未安装的插件</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=nx>call</span> <span class=nx>dein</span>#<span class=nx>install</span><span class=p>()</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>endif</span><span class=err>
</span></span></span></code></pre></div><p>在安装插件的代码后加上这两行设置:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-vim data-lang=vim><span class=line><span class=cl><span class=nx>filetype</span> <span class=nx>plugin</span> <span class=nx>indent</span> <span class=nx>on</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>syntax</span> <span class=nx>on</span><span class=err>
</span></span></span></code></pre></div><p>这样可以确保特定于文件类型的插件正常工作。</p><h2 id=代码补全>代码补全</h2><p>最简单的代码补全方式是利用 <a href=https://github.com/universal-ctags/ctags target=_blank rel="external nofollow noopener noreferrer">ctags<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a> 生成 tag 文件，补全插件解析 tag 文件进行补全，这种方式有以下两个好处：</p><ul><li>最小依赖</li><li>高效可靠，适用于任何规模的项目</li></ul><p>基于 tag 的补全不够智能，后来又诞生了 life-changer 级别的补全插件 <a href=https://github.com/ycm-core/YouCompleteMe target=_blank rel="external nofollow noopener noreferrer">YouCompleteMe<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>，可以提供 IDE 级别的代码补全。但YouCompleteMe 不是开箱即用的，需要下载依赖并编译，并且耦合度比较大，只支持特定语言（主要是 C++）。</p><p>目前体验补全体验最好的方式是基于 <em>LSP</em>（<em>Language Server protocal</em>）的方案。LSP 是一套通信协议，遵从 LSP 规范的客户端（各种编辑器/IDE）可以通过众多 LSP 服务端按协议标准进行通信，由客户端完成用户界面相关的事情，由服务端提编程语言相关的：补全，定义引用查找，诊断，帮助文档，重构等服务。架构图如下：</p><p><figure><img src=images/LSP.png alt=LSP><figcaption>LSP</figcaption></figure></p><p>有了 LSP，不同的 IDE/编辑器只需要实现 LSP 客户端，专心改进用户体验，所有补全的工作都交给 LSP 服务器。使用基于 LSP 的方案，用户可以在多种语言间无缝切换，让 Vim 支持所有语言（只要有 LSP 实现），用户只需要做以下两件事：</p><ul><li>选择 LSP 客户端</li><li>选择 LSP 服务器端</li></ul><p>目前 LSP 客户端有以下几种选择：</p><ul><li><a href=https://github.com/prabirshrestha/vim-lsp target=_blank rel="external nofollow noopener noreferrer">vim-lsp<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a></li><li><a href=https://github.com/autozimu/LanguageClient-neovim target=_blank rel="external nofollow noopener noreferrer">LanguageClient-neovim<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a></li><li>neovim-night 内置的 LSP 客户端，使用 Lua 语言配置，参考 <a href=https://github.com/neovim/nvim-lspconfig target=_blank rel="external nofollow noopener noreferrer">nvim-lspconfig<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a></li><li><a href=https://github.com/neoclide/coc.nvim target=_blank rel="external nofollow noopener noreferrer">coc.nvim<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a></li><li>YouCompleteMe 也提供了对 LSP 的支持</li></ul><p>coc.nvim 使用 Typescript 开发，是目前最流行、最强大的 LSP 客户端，已经发展成了一个 Vim 插件平台，存在大量基于 coc.nvim 开发的插件（coc 拓展），推荐大家使用 coc.nvim。</p><p>coc.nvim 依赖于 node.js，但 node.js 似乎已经不再支持 32 位机，因此最新的 coc.nvim 很可能无法在 32 位机上运行，请考虑其他几种方案。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-vim data-lang=vim><span class=line><span class=cl><span class=c>&#34; &lt;Tab&gt;选择补全候选</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>inoremap</span> <span class=p>&lt;</span><span class=nx>silent</span><span class=p>&gt;&lt;</span><span class=nx>expr</span><span class=p>&gt;</span> <span class=p>&lt;</span><span class=nx>TAB</span><span class=p>&gt;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>            \ <span class=nx>pumvisible</span><span class=p>()</span> ? <span class=s2>&#34;\&lt;C-n&gt;&#34;</span> :<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>            \ <span class=p>&lt;</span><span class=nx>SID</span><span class=p>&gt;</span><span class=nx>check_back_space</span><span class=p>()</span> ? <span class=s2>&#34;\&lt;TAB&gt;&#34;</span> :<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>            \ <span class=nx>coc</span>#<span class=nx>refresh</span><span class=p>()</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>inoremap</span> <span class=p>&lt;</span><span class=nx>expr</span><span class=p>&gt;&lt;</span><span class=nx>S</span><span class=p>-</span><span class=nx>TAB</span><span class=p>&gt;</span> <span class=nx>pumvisible</span><span class=p>()</span> ? <span class=s2>&#34;\&lt;C-p&gt;&#34;</span> : <span class=s2>&#34;\&lt;C-h&gt;&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>function</span><span class=p>!</span> <span class=nx>s</span>:<span class=nx>check_back_space</span><span class=p>()</span> <span class=nx>abort</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=k>let</span> <span class=nx>col</span> <span class=p>=</span> <span class=nx>col</span><span class=p>(</span><span class=s1>&#39;.&#39;</span><span class=p>)</span> <span class=p>-</span> <span class=m>1</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=nx>return</span> <span class=p>!</span><span class=nx>col</span> <span class=p>||</span> <span class=nx>getline</span><span class=p>(</span><span class=s1>&#39;.&#39;</span><span class=p>)</span>[<span class=nx>col</span> <span class=p>-</span> <span class=m>1</span>]  <span class=p>=~</span># <span class=s1>&#39;\s&#39;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>endfunction</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>&#34; gn 跳转到下一个错误，gN 跳转到上一个错误</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>nmap</span> <span class=p>&lt;</span><span class=nx>silent</span><span class=p>&gt;</span> <span class=nx>gN</span> <span class=p>&lt;</span><span class=nx>Plug</span><span class=p>&gt;(</span><span class=nx>coc</span><span class=p>-</span><span class=nx>diagnostic</span><span class=p>-</span><span class=nx>prev</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>nmap</span> <span class=p>&lt;</span><span class=nx>silent</span><span class=p>&gt;</span> <span class=nx>gn</span> <span class=p>&lt;</span><span class=nx>Plug</span><span class=p>&gt;(</span><span class=nx>coc</span><span class=p>-</span><span class=nx>diagnostic</span><span class=p>-</span><span class=nx>next</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>
</span></span></span><span class=line><span class=cl><span class=c>&#34; gd 跳转到定义，gs 跳转到引用，gt 跳转到类型定义，gK 显示文档</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>nmap</span> <span class=p>&lt;</span><span class=nx>silent</span><span class=p>&gt;</span> <span class=nx>gd</span> <span class=p>&lt;</span><span class=nx>Plug</span><span class=p>&gt;(</span><span class=nx>coc</span><span class=p>-</span><span class=nx>definition</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>nmap</span> <span class=p>&lt;</span><span class=nx>silent</span><span class=p>&gt;</span> <span class=nx>gs</span> <span class=p>&lt;</span><span class=nx>Plug</span><span class=p>&gt;(</span><span class=nx>coc</span><span class=p>-</span><span class=nx>references</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>nmap</span> <span class=p>&lt;</span><span class=nx>silent</span><span class=p>&gt;</span> <span class=nx>gt</span> <span class=p>&lt;</span><span class=nx>Plug</span><span class=p>&gt;(</span><span class=nx>coc</span><span class=p>-</span><span class=nx>type</span><span class=p>-</span><span class=nx>definition</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>nnoremap</span> <span class=p>&lt;</span><span class=nx>silent</span><span class=p>&gt;</span> <span class=nx>gK</span> :<span class=nx>call</span> <span class=p>&lt;</span><span class=nx>SID</span><span class=p>&gt;</span><span class=nx>show_documentation</span><span class=p>()&lt;</span><span class=nx>CR</span><span class=p>&gt;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>function</span><span class=p>!</span> <span class=nx>s</span>:<span class=nx>show_documentation</span><span class=p>()</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=k>if</span> <span class=p>(</span><span class=nx>index</span><span class=p>(</span>[<span class=s1>&#39;vim&#39;</span><span class=p>,</span><span class=s1>&#39;help&#39;</span>]<span class=p>,</span> &amp;<span class=nx>filetype</span><span class=p>)</span> <span class=p>&gt;=</span> <span class=m>0</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>        <span class=nx>execute</span> <span class=s1>&#39;h &#39;</span>.<span class=nx>expand</span><span class=p>(</span><span class=s1>&#39;&lt;cword&gt;&#39;</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=k>elseif</span> <span class=p>(</span><span class=nx>coc</span>#<span class=nx>rpc</span>#<span class=nx>ready</span><span class=p>())</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>        <span class=nx>call</span> <span class=nx>CocActionAsync</span><span class=p>(</span><span class=s1>&#39;doHover&#39;</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=k>else</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>        <span class=nx>execute</span> <span class=s1>&#39;!&#39;</span> . &amp;<span class=nx>keywordprg</span> . <span class=s2>&#34; &#34;</span> . <span class=nx>expand</span><span class=p>(</span><span class=s1>&#39;&lt;cword&gt;&#39;</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=k>endif</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>endfunction</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>
</span></span></span><span class=line><span class=cl><span class=c>&#34; &lt;Leaderf&gt;rv 改名，&lt;Leaderf&gt;rf 重构</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>nmap</span> <span class=p>&lt;</span><span class=nx>leader</span><span class=p>&gt;</span><span class=nx>rv</span> <span class=p>&lt;</span><span class=nx>Plug</span><span class=p>&gt;(</span><span class=nx>coc</span><span class=p>-</span><span class=nx>rename</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>nmap</span> <span class=p>&lt;</span><span class=nx>Leader</span><span class=p>&gt;</span><span class=nx>rf</span> <span class=p>&lt;</span><span class=nx>Plug</span><span class=p>&gt;(</span><span class=nx>coc</span><span class=p>-</span><span class=nx>refactor</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>
</span></span></span><span class=line><span class=cl><span class=c>&#34; &lt;C-f&gt; 和 &lt;C-b&gt; 滚动悬浮窗口</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>nnoremap</span> <span class=p>&lt;</span><span class=nx>silent</span><span class=p>&gt;&lt;</span><span class=nx>nowait</span><span class=p>&gt;&lt;</span><span class=nx>expr</span><span class=p>&gt;</span> <span class=p>&lt;</span><span class=nx>C</span><span class=p>-</span><span class=nx>f</span><span class=p>&gt;</span> <span class=nx>coc</span>#<span class=nx>float</span>#<span class=nx>has_scroll</span><span class=p>()</span> ? <span class=nx>coc</span>#<span class=nx>float</span>#<span class=nx>scroll</span><span class=p>(</span><span class=m>1</span><span class=p>)</span> : <span class=s2>&#34;\&lt;C-f&gt;&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>nnoremap</span> <span class=p>&lt;</span><span class=nx>silent</span><span class=p>&gt;&lt;</span><span class=nx>nowait</span><span class=p>&gt;&lt;</span><span class=nx>expr</span><span class=p>&gt;</span> <span class=p>&lt;</span><span class=nx>C</span><span class=p>-</span><span class=nx>b</span><span class=p>&gt;</span> <span class=nx>coc</span>#<span class=nx>float</span>#<span class=nx>has_scroll</span><span class=p>()</span> ? <span class=nx>coc</span>#<span class=nx>float</span>#<span class=nx>scroll</span><span class=p>(</span><span class=m>0</span><span class=p>)</span> : <span class=s2>&#34;\&lt;C-b&gt;&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>inoremap</span> <span class=p>&lt;</span><span class=nx>silent</span><span class=p>&gt;&lt;</span><span class=nx>nowait</span><span class=p>&gt;&lt;</span><span class=nx>expr</span><span class=p>&gt;</span> <span class=p>&lt;</span><span class=nx>C</span><span class=p>-</span><span class=nx>f</span><span class=p>&gt;</span> <span class=nx>coc</span>#<span class=nx>float</span>#<span class=nx>has_scroll</span><span class=p>()</span> ? <span class=s2>&#34;\&lt;c-r&gt;=coc#float#scroll(1)\&lt;cr&gt;&#34;</span> : <span class=s2>&#34;\&lt;Right&gt;&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>inoremap</span> <span class=p>&lt;</span><span class=nx>silent</span><span class=p>&gt;&lt;</span><span class=nx>nowait</span><span class=p>&gt;&lt;</span><span class=nx>expr</span><span class=p>&gt;</span> <span class=p>&lt;</span><span class=nx>C</span><span class=p>-</span><span class=nx>b</span><span class=p>&gt;</span> <span class=nx>coc</span>#<span class=nx>float</span>#<span class=nx>has_scroll</span><span class=p>()</span> ? <span class=s2>&#34;\&lt;c-r&gt;=coc#float#scroll(0)\&lt;cr&gt;&#34;</span> : <span class=s2>&#34;\&lt;Left&gt;&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>vnoremap</span> <span class=p>&lt;</span><span class=nx>silent</span><span class=p>&gt;&lt;</span><span class=nx>nowait</span><span class=p>&gt;&lt;</span><span class=nx>expr</span><span class=p>&gt;</span> <span class=p>&lt;</span><span class=nx>C</span><span class=p>-</span><span class=nx>f</span><span class=p>&gt;</span> <span class=nx>coc</span>#<span class=nx>float</span>#<span class=nx>has_scroll</span><span class=p>()</span> ? <span class=nx>coc</span>#<span class=nx>float</span>#<span class=nx>scroll</span><span class=p>(</span><span class=m>1</span><span class=p>)</span> : <span class=s2>&#34;\&lt;C-f&gt;&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>vnoremap</span> <span class=p>&lt;</span><span class=nx>silent</span><span class=p>&gt;&lt;</span><span class=nx>nowait</span><span class=p>&gt;&lt;</span><span class=nx>expr</span><span class=p>&gt;</span> <span class=p>&lt;</span><span class=nx>C</span><span class=p>-</span><span class=nx>b</span><span class=p>&gt;</span> <span class=nx>coc</span>#<span class=nx>float</span>#<span class=nx>has_scroll</span><span class=p>()</span> ? <span class=nx>coc</span>#<span class=nx>float</span>#<span class=nx>scroll</span><span class=p>(</span><span class=m>0</span><span class=p>)</span> : <span class=s2>&#34;\&lt;C-b&gt;&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>autocmd</span> <span class=nx>User</span> <span class=nx>CocJumpPlaceholder</span> <span class=nx>call</span> <span class=nx>CocActionAsync</span><span class=p>(</span><span class=s1>&#39;showSignatureHelp&#39;</span><span class=p>)</span><span class=err>
</span></span></span></code></pre></div><p>coc.nvim 有自己的配置文件，叫做 coc-settings.json，一般存放在 .vim（neovim 的话在 ~/.config/nvim）。一般我们会在 coc-settings.json 中微调 coc.nvim 和配置 LSP。</p><p>目前功能最强的 C++ LSP 服务器是 <a href=https://github.com/MaskRay/ccls target=_blank rel="external nofollow noopener noreferrer">ccls<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>，在 coc-settings.json 中配置 ccls：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;languageserver&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;ccls&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;command&#34;</span><span class=p>:</span> <span class=s2>&#34;ccls&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;filetypes&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;c&#34;</span><span class=p>,</span> <span class=s2>&#34;cc&#34;</span><span class=p>,</span> <span class=s2>&#34;cpp&#34;</span><span class=p>,</span> <span class=s2>&#34;c++&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;rootPatterns&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;.ccls&#34;</span><span class=p>,</span> <span class=s2>&#34;compile_commands.json&#34;</span><span class=p>,</span> <span class=s2>&#34;.git/&#34;</span><span class=p>,</span> <span class=s2>&#34;.root&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;initializationOptions&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;cache&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;directory&#34;</span><span class=p>:</span> <span class=s2>&#34;.cache/ccls&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;highlight&#34;</span><span class=p>:</span> <span class=p>{</span><span class=nt>&#34;lsRanges&#34;</span><span class=p>:</span> <span class=kc>true</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>以上配置仅在编辑 C/C++ 文件使用命令<code>ccls</code>启动 LSP 服务器，将项目根目录设置为包含<code>rootpatterns</code>中任意文件的目录，索引文件存放在项目根目录的隐藏目录 .cache/ccls 中。<code>highlight</code>字段指示 ccls 生成高亮信息，基于 LSP 的语法高亮插件会利用 LSP 服务器提供的信息进行精确的语法高亮。</p><p>为了让 C++ LSP 服务器知道以程序以何种方法编译，必须要在项目根目录生成 <a href="https://www.bing.com/search?q=compile_commands.json&qs=n&form=QBRE&sp=-1&pq=%E7%BC%96%E8%AF%91%E6%95%B0%E6%8D%AE%E5%BA%93+c%2B%2B&sc=0-9&sk=&cvid=5064D653FECD4E23B21AC879A2777990" target=_blank rel="external nofollow noopener noreferrer">编译数据库<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>（compile_commands.json）。CMake 内置了对编译数据库的支持，只需要在执行 CMake 时加上<code>-DCMAKE_EXPORT_COMPILE_COMMANDS=1</code>即可;如果使用 Makefile，可以利用 <a href=https://github.com/rizsotto/Bear target=_blank rel="external nofollow noopener noreferrer">Bear<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a> 生成编译数据库，通过<code>bear make</code>来执行 Makefile。Bear 需要执行 Makefile 才能生成编译数据库，如果项目无法正常构建，将不能生成编译数据库，没法使用 LSP 的功能。</p><p>有些 vimmer 还基于 coc.nvim 开发了一些插件，可以在<a href=https://github.com/neoclide/coc.nvim/wiki/Using-coc-extensions target=_blank rel="external nofollow noopener noreferrer">这里<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>查看完整的拓展列表。这里给两点建议：</p><ul><li>尽量不要用 Vim 开发环境开发环境插件管理器安装 coc.nvim 拓展</li></ul><p>coc 基于 coc.nvim，使用 Typescript 编写，有些 coc 拓展仅支持使用 coc.nvim 安装。建议在 .vimrc 中定义列表<code>let g:coc_global_extensions</code>，把自己想安装的 coc 拓展写进入，coc.nvim 会在第一次打开文件时安装。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-vim data-lang=vim><span class=line><span class=cl><span class=k>let</span> <span class=nx>g</span>:<span class=nx>coc_global_extensions</span>` <span class=p>=</span> [<span class=s1>&#39;coc-vimlsp&#39;</span><span class=p>,</span> <span class=s1>&#39;coc-rust-analyzer&#39;</span>]<span class=err>
</span></span></span></code></pre></div><ul><li>优先使用 coc 拓展配置 LSP</li></ul><p><a href=https://github.com/fannheyward/coc-rust-analyzer target=_blank rel="external nofollow noopener noreferrer">coc-rust-analyzer<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a> 之类的 LSP coc 拓展通常利用 coc.nvim 实现了更多 LSP 功能，请优先使用这些拓展，只在没有对应语言的 LSP coc 拓展时手动配置 LSP。</p><p>使用 ccls ，即使是在 Linux 这种规模的代码仓库中也可以流畅地补全代码。</p><p><figure><img src=images/code-complete.gif alt=code-completion><figcaption>code-completion</figcaption></figure></p><h2 id=错误检查>错误检查</h2><p>目前错误检查有两种方案：</p><ul><li>定时调用外部程序实现实时错误检测</li><li>LSP</li></ul><p>如果使用 coc.nvim，不需要额外配置，开箱即用。coc.nvim 使用 LSP 进行错误检查，不够灵活，无法使用 linter 实时检测代码。</p><p>基于外部程序的方案非常灵活，比如，可以在基础的错误检测之外同时使用 clang-tidy 等工具进行检测。目前这种方案最好的插件是 <a href=https://github.com/dense-analysis/ale target=_blank rel="external nofollow noopener noreferrer">ale<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>，并且 ale 可以与 coc.nvim 共存，用 ale 做实时错误检查，coc.nvim 做补全。如果没有特殊需求，直接使用 coc.nvim 即可。</p><p><figure><img src=images/dynamic-check.gif alt="dynamic check"><figcaption>dynamic check</figcaption></figure></p><h2 id=符号索引>符号索引</h2><p>LSP 已经提供了符号索引的功能，可以方便地跳转到定义/引用。通常 LSP 的功能已经够用，但 LSP 存在以下缺点：</p><ul><li>仅支持单一语言，在多语言项目中无法无法工作</li></ul><p>比如可能存在汇编和 C 混合的项目，汇编定义了一个变量在 C 中读写，LSP 无法理解汇编，找不到变量定义的地方。</p><ul><li>LSP 的符号索引功能有限</li></ul><p>LSP 一般不支持跳转到变量赋值的地方，不支持查找包含该头文件的源文件等。</p><p>我们可以使用静态代码索引工具，克服 LSP 的以上缺点。目前静态代码索引最好的方案是 ctags 和 <a href=https://www.gnu.org/software/global/ target=_blank rel="external nofollow noopener noreferrer">global(gtags)<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>混合使用，具体的方法参考韦应笑的深度文章<a href=https://zhuanlan.zhihu.com/p/36279445 target=_blank rel="external nofollow noopener noreferrer">Vim 8 中 C/C++ 符号索引：GTags 篇<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>，不再赘述。。</p><p><strong>Tips</strong>:</p><ul><li><p>建议同时使用 LSP 和静态索引工具，LSP 支持的功能用 LSP，不支持的功能或没有 LSP 时用静态索引工具，由于实现这个功能需要用 VimL 编程，这里不介绍，有兴趣的话可以参考我的配置</p></li><li><p>ccls 实现了更多的功能，如查看类继承体系，查看调用链，查找类的全部实例等。参考配置如下，部分功能用的比较少，就不创建快捷键了，直接使用命令。</p></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-vim data-lang=vim><span class=line><span class=cl><span class=c>&#34; This comands are defined for ccls(only supports C/C++)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>command</span><span class=p>!</span> <span class=p>-</span><span class=nx>nargs</span><span class=p>=</span><span class=m>0</span> <span class=nx>Derived</span> :<span class=nx>call</span> <span class=nx>CocLocations</span><span class=p>(</span><span class=s1>&#39;ccls&#39;</span><span class=p>,</span><span class=s1>&#39;$ccls/inheritance&#39;</span><span class=p>,</span>{<span class=s1>&#39;derived&#39;</span>:<span class=nx>v</span>:<span class=nx>true</span>}<span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>command</span><span class=p>!</span> <span class=p>-</span><span class=nx>nargs</span><span class=p>=</span><span class=m>0</span> <span class=nx>Base</span> :<span class=nx>call</span> <span class=nx>CocLocations</span><span class=p>(</span><span class=s1>&#39;ccls&#39;</span><span class=p>,</span><span class=s1>&#39;$ccls/inheritance&#39;</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>command</span><span class=p>!</span> <span class=p>-</span><span class=nx>nargs</span><span class=p>=</span><span class=m>0</span> <span class=nx>VarAll</span> :<span class=nx>call</span> <span class=nx>CocLocations</span><span class=p>(</span><span class=s1>&#39;ccls&#39;</span><span class=p>,</span><span class=s1>&#39;$ccls/vars&#39;</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>command</span><span class=p>!</span> <span class=p>-</span><span class=nx>nargs</span><span class=p>=</span><span class=m>0</span> <span class=nx>VarLocal</span> :<span class=nx>call</span> <span class=nx>CocLocations</span><span class=p>(</span><span class=s1>&#39;ccls&#39;</span><span class=p>,</span><span class=s1>&#39;$ccls/vars&#39;</span><span class=p>,</span> {<span class=s1>&#39;kind&#39;</span>: <span class=m>1</span>}<span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>command</span><span class=p>!</span> <span class=p>-</span><span class=nx>nargs</span><span class=p>=</span><span class=m>0</span> <span class=nx>VarArg</span> :<span class=nx>call</span> <span class=nx>CocLocations</span><span class=p>(</span><span class=s1>&#39;ccls&#39;</span><span class=p>,</span><span class=s1>&#39;$ccls/vars&#39;</span><span class=p>,</span> {<span class=s1>&#39;kind&#39;</span>: <span class=m>4</span>}<span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>command</span><span class=p>!</span> <span class=p>-</span><span class=nx>nargs</span><span class=p>=</span><span class=m>0</span> <span class=nx>MemberFunction</span> :<span class=nx>call</span> <span class=nx>CocLocations</span><span class=p>(</span><span class=s1>&#39;ccls&#39;</span><span class=p>,</span><span class=s1>&#39;$ccls/member&#39;</span><span class=p>,</span> {<span class=s1>&#39;kind&#39;</span>: <span class=m>3</span>}<span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>command</span><span class=p>!</span> <span class=p>-</span><span class=nx>nargs</span><span class=p>=</span><span class=m>0</span> <span class=nx>MemberType</span> :<span class=nx>call</span> <span class=nx>CocLocations</span><span class=p>(</span><span class=s1>&#39;ccls&#39;</span><span class=p>,</span><span class=s1>&#39;$ccls/member&#39;</span><span class=p>,</span> {<span class=s1>&#39;kind&#39;</span>: <span class=m>2</span>}<span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>command</span><span class=p>!</span> <span class=p>-</span><span class=nx>nargs</span><span class=p>=</span><span class=m>0</span> <span class=nx>MemberVar</span> :<span class=nx>call</span> <span class=nx>CocLocations</span><span class=p>(</span><span class=s1>&#39;ccls&#39;</span><span class=p>,</span><span class=s1>&#39;$ccls/member&#39;</span><span class=p>,</span> {<span class=s1>&#39;kind&#39;</span>: <span class=m>4</span>}<span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>nmap</span> <span class=p>&lt;</span><span class=nx>silent</span><span class=p>&gt;</span> <span class=nx>gc</span> :<span class=nx>call</span> <span class=nx>CocLocations</span><span class=p>(</span><span class=s1>&#39;ccls&#39;</span><span class=p>,</span><span class=s1>&#39;$ccls/call&#39;</span><span class=p>)&lt;</span><span class=nx>CR</span><span class=p>&gt;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>nmap</span> <span class=p>&lt;</span><span class=nx>silent</span><span class=p>&gt;</span> <span class=nx>gC</span> :<span class=nx>call</span> <span class=nx>CocLocations</span><span class=p>(</span><span class=s1>&#39;ccls&#39;</span><span class=p>,</span><span class=s1>&#39;$ccls/call&#39;</span><span class=p>,</span> {<span class=s1>&#39;callee&#39;</span>: <span class=nx>v</span>:<span class=nx>true</span>}<span class=p>)&lt;</span><span class=nx>CR</span><span class=p>&gt;</span><span class=err>
</span></span></span></code></pre></div><p><figure><img src=images/symbol-jump.gif alt="symbol jump"><figcaption>symbol jump</figcaption></figure></p><h2 id=任务系统>任务系统</h2><p>在古老的 Vim 工作流中，项目的构建一直是个老大难的问题，要么手动完成，要么自己写简单的脚本完成，VSCode 引入任务系统解决了这个问题，韦易笑大佬的 <a href=https://github.com/skywind3000/asyncrun.vim target=_blank rel="external nofollow noopener noreferrer">asyncrun.vim<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a> 和 <a href=https://github.com/skywind3000/asynctasks.vim target=_blank rel="external nofollow noopener noreferrer">asynctasks.vim<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a> 又将 VSCode 的任务系统引入到了 Vim 中，彻底改变了 Vim 的工作流。这充分体现了 Vim 的优势，Vim 用户非常乐于吸收别的编辑器的优点，让 Vim 变得更好。</p><p>asyncrun.vim 让用户可以异步运行 shell 命令，asynctasks 让用户可以将常用的命令写入到配置文件中（~/.vim/tasks.ini 或项目根目录中的 tasks.ini），一次编写多次使用。详细的使用方法请参考插件的中文文档。基本配置如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-vim data-lang=vim><span class=line><span class=cl><span class=c>&#34; 将终端放到 tab 中</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>let</span> <span class=nx>g</span>:<span class=nx>asynctasks_term_pos</span> <span class=p>=</span> <span class=s1>&#39;tab&#39;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>&#34; 设置 quickfix 大小</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>let</span> <span class=nx>g</span>:<span class=nx>asyncrun_open</span> <span class=p>=</span> <span class=m>10</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>&#34; 设置项目根目录标志</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>&#34; 实际上，许多插件都使用这种方法定位根目录，因此可以定一个变量 g:rootmarks，</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>&#34; 将所有插件的根目录标志都设置为 g:rootmarks</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>let</span> <span class=nx>g</span>:<span class=nx>asyncrun_rootmarks</span> <span class=p>=</span> [<span class=s1>&#39;.compile_commands.json&#39;</span><span class=p>,</span> <span class=s1>&#39;.ccls&#39;</span><span class=p>,</span> <span class=s1>&#39;.git&#39;</span>]<span class=err>
</span></span></span></code></pre></div><p>以构建 CMake 项目为例，我需要以不同的模式（Debug/Release）执行 CMake，编译项目，可能还会删除二进制目录，利用这两个 life-changer 级别的插件，可以实现一键配置、编译、运行、清理目录。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=k>[project-build]</span>
</span></span><span class=line><span class=cl><span class=na>command</span> <span class=o>=</span> <span class=s>cmake --build _builds -- VERBOSE=1</span>
</span></span><span class=line><span class=cl><span class=na>cwd</span><span class=o>=</span><span class=s>$(VIM_ROOT)</span>
</span></span><span class=line><span class=cl><span class=na>notify</span><span class=o>=</span><span class=s>echo</span>
</span></span><span class=line><span class=cl><span class=na>save</span><span class=o>=</span><span class=s>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[project-run]</span>
</span></span><span class=line><span class=cl><span class=na>command/linux</span><span class=o>=</span><span class=s>_builds/$(VIM_PRONAME)</span>
</span></span><span class=line><span class=cl><span class=na>command/win32</span><span class=o>=</span><span class=s>_builds\$(VIM_PRONAME).exe</span>
</span></span><span class=line><span class=cl><span class=na>cwd</span><span class=o>=</span><span class=s>$(VIM_ROOT)</span>
</span></span><span class=line><span class=cl><span class=na>output</span><span class=o>=</span><span class=s>terminal</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[project-clean]</span>
</span></span><span class=line><span class=cl><span class=na>command/linux</span><span class=o>=</span><span class=s>rm -rf _builds</span>
</span></span><span class=line><span class=cl><span class=na>command/win32</span><span class=o>=</span><span class=s>rd/s/q _builds</span>
</span></span><span class=line><span class=cl><span class=na>notify</span><span class=o>=</span><span class=s>echo</span>
</span></span><span class=line><span class=cl><span class=na>cwd</span><span class=o>=</span><span class=s>$(VIM_ROOT)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[project-configure]</span>
</span></span><span class=line><span class=cl><span class=na>command/linux</span><span class=o>=</span><span class=s>cmake -DCMAKE_EXPORT_COMPILE_COMMANDS=1 -DCMAKE_BUILD_TYPE=Debug -S. -B_builds &amp;&amp; ln -sf _builds/compile_commands.json .</span>
</span></span><span class=line><span class=cl><span class=na>command/win32</span><span class=o>=</span><span class=s>cmake -DCMAKE_EXPORT_COMPILE_COMMANDS=1 -DCMAKE_BUILD_TYPE=Debug -G &#34;MinGW Makefiles&#34; -S. -B_builds &amp;&amp; copy _builds\compile_commands.json .</span>
</span></span><span class=line><span class=cl><span class=na>cwd</span><span class=o>=</span><span class=s>$(VIM_ROOT)</span>
</span></span><span class=line><span class=cl><span class=na>notify</span><span class=o>=</span><span class=s>echo</span>
</span></span><span class=line><span class=cl><span class=na>save</span><span class=o>=</span><span class=s>2</span>
</span></span></code></pre></div><p>我的 tasks.ini 中写好常用的任务命令，您可以直接将我的<a href=https://github.com/kongjun18/nvim-config/blob/master/tasks.ini target=_blank rel="external nofollow noopener noreferrer">tasks.ini<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>直接复制到自己的配置中。</p><p>在 .vimrc 中映射几个快捷键：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-vim data-lang=vim><span class=line><span class=cl><span class=c>&#34; 编辑全局 tasks.ini，随时优化工作流</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>command</span><span class=p>!</span> <span class=nx>TaskEdit</span> <span class=nx>exec</span> <span class=s1>&#39;vsp &#39;</span> .. <span class=nx>general</span>#<span class=nx>vimfiles</span> .. <span class=s1>&#39;/tasks.ini&#39;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>
</span></span></span><span class=line><span class=cl><span class=c>&#34; 由于 &lt;Tab&gt; 的码值和 &lt;C-I&gt; 相同，映射这些快捷键后 &lt;C-I&gt; 会变慢</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>nnoremap</span>  <span class=p>&lt;</span><span class=nx>Tab</span><span class=p>&gt;</span><span class=m>5</span> :<span class=nx>AsyncTask</span> <span class=nx>file</span><span class=p>-</span><span class=nx>build</span><span class=p>&lt;</span><span class=nx>cr</span><span class=p>&gt;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>nnoremap</span>  <span class=p>&lt;</span><span class=nx>Tab</span><span class=p>&gt;</span><span class=m>6</span> :<span class=nx>AsyncTask</span> <span class=nx>file</span><span class=p>-</span><span class=nx>run</span><span class=p>&lt;</span><span class=nx>cr</span><span class=p>&gt;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>nnoremap</span>  <span class=p>&lt;</span><span class=nx>Tab</span><span class=p>&gt;</span><span class=m>7</span> :<span class=nx>AsyncTask</span> <span class=nx>project</span><span class=p>-</span><span class=nx>configure</span><span class=p>&lt;</span><span class=nx>CR</span><span class=p>&gt;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>nnoremap</span>  <span class=p>&lt;</span><span class=nx>Tab</span><span class=p>&gt;</span><span class=m>8</span> :<span class=nx>AsyncTask</span> <span class=nx>project</span><span class=p>-</span><span class=nx>build</span><span class=p>&lt;</span><span class=nx>CR</span><span class=p>&gt;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>nnoremap</span>  <span class=p>&lt;</span><span class=nx>Tab</span><span class=p>&gt;</span><span class=m>9</span> :<span class=nx>AsyncTask</span> <span class=nx>project</span><span class=p>-</span><span class=nx>run</span><span class=p>&lt;</span><span class=nx>CR</span><span class=p>&gt;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>nnoremap</span>  <span class=p>&lt;</span><span class=nx>Tab</span><span class=p>&gt;</span><span class=m>0</span> :<span class=nx>AsyncTask</span> <span class=nx>project</span><span class=p>-</span><span class=nx>clean</span><span class=p>&lt;</span><span class=nx>CR</span><span class=p>&gt;</span><span class=err>
</span></span></span></code></pre></div><p><figure><img src=images/build-project.gif alt=build-project><figcaption>build-project</figcaption></figure></p><p>再回头看前面提到的错误检测，我们可以将执行 linter 的命令写成一个任务，在代码没有语法错误后调用。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-vim data-lang=vim><span class=line><span class=cl>[<span class=nx>clang</span><span class=p>-</span><span class=nx>tidy</span>]<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>command</span><span class=p>=</span><span class=nx>find</span> . <span class=p>-</span><span class=nx>type</span> <span class=nx>d</span> <span class=p>-</span><span class=nx>name</span> <span class=s1>&#39;.cache&#39;</span> <span class=p>-</span><span class=nx>prune</span> <span class=p>-</span><span class=nx>o</span> <span class=p>-</span><span class=nx>type</span> <span class=nx>d</span> <span class=p>-</span><span class=nx>name</span> <span class=s1>&#39;_builds&#39;</span> <span class=p>-</span><span class=nx>prune</span> <span class=p>-</span><span class=nx>o</span> <span class=p>-</span><span class=nx>name</span> <span class=s1>&#39;*.cpp&#39;</span> <span class=p>-</span><span class=nx>print</span> <span class=p>|</span> <span class=nx>xargs</span> <span class=nx>clang</span><span class=p>-</span><span class=nx>tidy</span> <span class=p>-</span><span class=nx>checks</span><span class=p>=</span><span class=nx>level2</span> <span class=p>-</span><span class=nx>p</span> <span class=nx>default</span>/<span class=nx>compile_commands</span>.<span class=nx>json</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>cwd</span><span class=p>=(</span><span class=nx>VIM_ROOT</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>notify</span><span class=p>=</span><span class=nx>echo</span><span class=err>
</span></span></span></code></pre></div><p>可能您还想统计本项目的代码量，也可以通过 asynctask.vim 完成：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-vim data-lang=vim><span class=line><span class=cl>[<span class=nx>cloc</span>]<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>command</span><span class=p>=</span><span class=nx>cloc</span> <span class=p>--</span><span class=nx>exclude</span><span class=p>-</span><span class=nx>dir</span><span class=p>=</span><span class=nx>_builds</span><span class=p>,</span>.* .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>cwd</span><span class=p>=(</span><span class=nx>VIM_ROOT</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>notify</span><span class=p>=</span><span class=nx>echo</span><span class=err>
</span></span></span></code></pre></div><p>只有想象力丰富，asyncrun.vim 几乎没有完不成的工作！</p><p>您可能会有这样的疑问，假如我定义了 100 个任务，平时只用其中的少数几个任务，岂不是要经常打开 tasks.ini 查询？这样的困扰根本不存在，Vim 的另一个强大之处就是插件可以配合工作，我们会在后面介绍解决这个问题的办法。</p><h2 id=语法高亮>语法高亮</h2><p>基于正则表达式的语法高亮在 C++ 这种语法非常复杂的语言上表现的很差，2021 年可以彻底抛弃掉这种老掉牙的高亮方案了。请使用 <a href=https://github.com/nvim-treesitter/nvim-treesitter target=_blank rel="external nofollow noopener noreferrer">nvim-treesitter<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>，它是目前最好的高亮方案（只支持 neovim-nightly），如果用 Vim 的话请使用 <a href=https://github.com/jackguo380/vim-lsp-cxx-highlight target=_blank rel="external nofollow noopener noreferrer">vim-lsp-cxx-highlight<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>。</p><p>vim-lsp-cxx-highlight 基于 LSP 实现精确的高亮，但存在性能问题，打开文件时有点晃眼，前面 coc-settings.json 中已经配置好了 vim-lsp-cxx-highlight。</p><p>nvim-treesitter，基于语义高亮代码，性能强，容错好。</p><p><figure><img src=images/highlight.png alt=highlight><figcaption>highlight</figcaption></figure></p><p>配置代码如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-vim data-lang=vim><span class=line><span class=cl><span class=nx>lua</span> <span class=p>&lt;&lt;</span><span class=nx>EOF</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>require</span><span class=s1>&#39;nvim-treesitter.configs&#39;</span>.<span class=nx>setup</span> {<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=nx>ensure_installed</span> <span class=p>=</span> {<span class=s1>&#39;c&#39;</span><span class=p>,</span> <span class=s1>&#39;cpp&#39;</span><span class=p>,</span> <span class=s1>&#39;toml&#39;</span><span class=p>,</span> <span class=s1>&#39;json&#39;</span><span class=p>,</span> <span class=s1>&#39;lua&#39;</span><span class=p>,</span> <span class=s1>&#39;python&#39;</span><span class=p>,</span> <span class=s1>&#39;bash&#39;</span><span class=p>,</span> <span class=s1>&#39;rust&#39;</span>}<span class=p>,</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=nx>highlight</span> <span class=p>=</span> {<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=nx>enable</span> <span class=p>=</span> <span class=nx>true</span><span class=p>,</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  }<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>}<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=p>--</span> <span class=nx>integrate</span> <span class=nx>with</span> <span class=nx>rainbow</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>require</span> <span class=s2>&#34;nvim-treesitter.highlight&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>local</span> <span class=nx>hlmap</span> <span class=p>=</span> <span class=nx>vim</span>.<span class=nx>treesitter</span>.<span class=nx>highlighter</span>.<span class=nx>hl_map</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>hlmap</span>.<span class=nx>error</span> <span class=p>=</span> <span class=nx>nil</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>hlmap</span>[<span class=s2>&#34;punctuation.delimiter&#34;</span>] <span class=p>=</span> <span class=s2>&#34;Delimiter&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>hlmap</span>[<span class=s2>&#34;punctuation.bracket&#34;</span>] <span class=p>=</span> <span class=nx>nil</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>EOF</span><span class=err>
</span></span></span></code></pre></div><p><strong>Tip</strong>：您可以在 vimrc 中进行判断，在 Vim 中使用 vim-lsp-cxx-highlight，在 neovim-nightly 中使用 nvim-treesitter，可以参考我配置中的 init.vim 和 autoload/tools.vim。</p><h2 id=文件操作>文件操作</h2><p>许多 Vim 外的编辑器用户喜欢使用文件树定位项目文件，但 Vimmer 更喜欢使用模糊查找插件定位文件。尽管如此，文件树也并非一无用处，在浏览自己不熟悉的项目时，文件树插件可以帮助我们了解项目结构。Vim 自带文件树插件，也有许多 vimmer 编写的插件，这里介绍最经典的 <a href=https://github.com/preservim/nerdtree target=_blank rel="external nofollow noopener noreferrer">NERDtree<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>。</p><p>NERDtree 虽然是最经典的文件树插件，但在许多介绍 Vim 的文章中被骂的狗血临头。许多人批评 NERDtree 性能差，在 Linux 这种规模的项目中会直接卡死，但应付中小型项目绰绰有余。</p><p><a href=https://github.com/Yggdroot/LeaderF target=_blank rel="external nofollow noopener noreferrer">Leaderf<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a> 是国人开发的一款模糊查找插件，性能最强，并且支持许多插件。配置如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-vim data-lang=vim><span class=line><span class=cl><span class=k>let</span> <span class=nx>g</span>:<span class=nx>Lf_PreviewResult</span> <span class=p>=</span> {<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>            \ <span class=s1>&#39;File&#39;</span>: <span class=m>0</span><span class=p>,</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>            \ <span class=s1>&#39;Buffer&#39;</span>: <span class=m>0</span><span class=p>,</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>            \ <span class=s1>&#39;Mru&#39;</span>: <span class=m>0</span><span class=p>,</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>            \ <span class=s1>&#39;Tag&#39;</span>: <span class=m>1</span><span class=p>,</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>            \ <span class=s1>&#39;BufTag&#39;</span>: <span class=m>1</span><span class=p>,</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>            \ <span class=s1>&#39;Function&#39;</span>: <span class=m>1</span><span class=p>,</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>            \ <span class=s1>&#39;Line&#39;</span>: <span class=m>0</span><span class=p>,</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>            \ <span class=s1>&#39;Colorscheme&#39;</span>: <span class=m>0</span><span class=p>,</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>            \ <span class=s1>&#39;Rg&#39;</span>: <span class=m>1</span><span class=p>,</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>            \ <span class=s1>&#39;Gtags&#39;</span>: <span class=m>1</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>            \}<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>let</span> <span class=nx>g</span>:<span class=nx>Lf_PreviewInPopup</span> <span class=p>=</span> <span class=m>1</span>                       <span class=c>&#34; 在 popup 窗口中预览结果</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>let</span> <span class=nx>g</span>:<span class=nx>Lf_PreviewCode</span> <span class=p>=</span> <span class=m>1</span>                          <span class=c>&#34; 预览代码</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>let</span> <span class=nx>g</span>:<span class=nx>Lf_RootMarkers</span> <span class=p>=</span> [<span class=s1>&#39;.root&#39;</span><span class=p>,</span> <span class=s1>&#39;compile_command.json&#39;</span><span class=p>,</span> <span class=s1>&#39;.git&#39;</span>] <span class=c>&#34;你的根目录标志</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>let</span> <span class=nx>g</span>:<span class=nx>Lf_WorkingDirectoryMode</span> <span class=p>=</span> <span class=s1>&#39;A&#39;</span>              <span class=c>&#34; 设置 LeaderF 工作目录为项目根目录，如果不在项目中，则为当前目录。</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>let</span> <span class=nx>g</span>:<span class=nx>Lf_ShortcutF</span> <span class=p>=</span> <span class=s2>&#34;&lt;Leader&gt;f&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>let</span> <span class=nx>g</span>:<span class=nx>Lf_ShortcutB</span> <span class=p>=</span> <span class=s2>&#34;&lt;Leader&gt;bl&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>nnoremap</span> <span class=p>&lt;</span><span class=nx>silent</span><span class=p>&gt;&lt;</span><span class=nx>Leader</span><span class=p>&gt;</span><span class=nx>p</span> :<span class=nx>LeaderfFunctionAll</span><span class=p>&lt;</span><span class=nx>CR</span><span class=p>&gt;</span> <span class=c>&#34; 搜索函数</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>nnoremap</span> <span class=p>&lt;</span><span class=nx>silent</span><span class=p>&gt;&lt;</span><span class=nx>Leader</span><span class=p>&gt;</span><span class=nx>l</span> :<span class=nx>LeaderfBufTagAll</span><span class=p>&lt;</span><span class=nx>CR</span><span class=p>&gt;</span>   <span class=c>&#34; 搜索缓冲区中的 tag</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>nnoremap</span> <span class=p>&lt;</span><span class=nx>silent</span><span class=p>&gt;&lt;</span><span class=nx>Leader</span><span class=p>&gt;</span><span class=nx>d</span> :<span class=nx>LeaderfTag</span><span class=p>&lt;</span><span class=nx>CR</span><span class=p>&gt;</span>         <span class=c>&#34; 搜索项目中的 tag</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>nnoremap</span> <span class=p>&lt;</span><span class=nx>silent</span><span class=p>&gt;&lt;</span><span class=nx>leader</span><span class=p>&gt;</span><span class=nx>h</span> :<span class=nx>LeaderfHelp</span><span class=p>&lt;</span><span class=nx>CR</span><span class=p>&gt;</span>        <span class=c>&#34; 搜索 vim help</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>nnoremap</span> <span class=p>&lt;</span><span class=nx>Leader</span><span class=p>&gt;</span><span class=nx>rg</span> :<span class=nx>Leaderf</span> <span class=nx>rg</span><span class=p>&lt;</span><span class=nx>Space</span><span class=p>&gt;</span>             <span class=c>&#34; 调用 ripgrep 查找字符串</span><span class=err>
</span></span></span></code></pre></div><p>现在，只要按下 &lt;Leader>f ，即使是 Linux 这种级别的项目，也能在一瞬间切换到目标文件。</p><p><figure><img src=images/LeaderF.gif alt=LeaderF><figcaption>LeaderF</figcaption></figure></p><p>既然 LeaderF 的模糊搜索功能如此强大，能不能让 LeaderF 搜索我们定义的 asynctask.vim 任务？答案当然是可以的！</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-vim data-lang=vim><span class=line><span class=cl><span class=k>function</span><span class=p>!</span> <span class=nx>s</span>:<span class=nx>lf_task_source</span><span class=p>(</span>...<span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=k>let</span> <span class=nx>rows</span> <span class=p>=</span> <span class=nx>asynctasks</span>#<span class=nx>source</span><span class=p>(</span>&amp;<span class=nx>columns</span> * <span class=m>48</span> / <span class=m>100</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=k>let</span> <span class=nx>source</span> <span class=p>=</span> []<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=nx>for</span> <span class=nx>row</span> <span class=nx>in</span> <span class=nx>rows</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>        <span class=k>let</span> <span class=nx>name</span> <span class=p>=</span> <span class=nx>row</span>[<span class=m>0</span>]<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>        <span class=k>let</span> <span class=nx>source</span> <span class=p>+=</span> [<span class=nx>name</span> . <span class=s1>&#39;  &#39;</span> . <span class=nx>row</span>[<span class=m>1</span>] . <span class=s1>&#39;  : &#39;</span> . <span class=nx>row</span>[<span class=m>2</span>]]<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=nx>endfor</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=nx>return</span> <span class=nx>source</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>endfunction</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>function</span><span class=p>!</span> <span class=nx>s</span>:<span class=nx>lf_task_accept</span><span class=p>(</span><span class=nx>line</span><span class=p>,</span> <span class=nx>arg</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=k>let</span> <span class=nx>pos</span> <span class=p>=</span> <span class=nx>stridx</span><span class=p>(</span><span class=nx>a</span>:<span class=nx>line</span><span class=p>,</span> <span class=s1>&#39;&lt;&#39;</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=k>if</span> <span class=nx>pos</span> <span class=p>&lt;</span> <span class=m>0</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>        <span class=nx>return</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=k>endif</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=k>let</span> <span class=nx>name</span> <span class=p>=</span> <span class=nx>strpart</span><span class=p>(</span><span class=nx>a</span>:<span class=nx>line</span><span class=p>,</span> <span class=m>0</span><span class=p>,</span> <span class=nx>pos</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=k>let</span> <span class=nx>name</span> <span class=p>=</span> <span class=nx>substitute</span><span class=p>(</span><span class=nx>name</span><span class=p>,</span> <span class=s1>&#39;^\s*\(.\{-}\)\s*$&#39;</span><span class=p>,</span> <span class=s1>&#39;\1&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=k>if</span> <span class=nx>name</span> <span class=p>!=</span> <span class=s1>&#39;&#39;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>        <span class=nx>exec</span> <span class=s2>&#34;AsyncTask &#34;</span> . <span class=nx>name</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=k>endif</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>endfunction</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>function</span><span class=p>!</span> <span class=nx>s</span>:<span class=nx>lf_task_digest</span><span class=p>(</span><span class=nx>line</span><span class=p>,</span> <span class=nx>mode</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=k>let</span> <span class=nx>pos</span> <span class=p>=</span> <span class=nx>stridx</span><span class=p>(</span><span class=nx>a</span>:<span class=nx>line</span><span class=p>,</span> <span class=s1>&#39;&lt;&#39;</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=k>if</span> <span class=nx>pos</span> <span class=p>&lt;</span> <span class=m>0</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>        <span class=nx>return</span> [<span class=nx>a</span>:<span class=nx>line</span><span class=p>,</span> <span class=m>0</span>]<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=k>endif</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=k>let</span> <span class=nx>name</span> <span class=p>=</span> <span class=nx>strpart</span><span class=p>(</span><span class=nx>a</span>:<span class=nx>line</span><span class=p>,</span> <span class=m>0</span><span class=p>,</span> <span class=nx>pos</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=nx>return</span> [<span class=nx>name</span><span class=p>,</span> <span class=m>0</span>]<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>endfunction</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>function</span><span class=p>!</span> <span class=nx>s</span>:<span class=nx>lf_win_init</span><span class=p>(</span>...<span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=nx>setlocal</span> <span class=nx>nonumber</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=nx>setlocal</span> <span class=nx>nowrap</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>endfunction</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>let</span> <span class=nx>g</span>:<span class=nx>Lf_Extensions</span> <span class=p>=</span> <span class=nx>get</span><span class=p>(</span><span class=nx>g</span>:<span class=p>,</span> <span class=s1>&#39;Lf_Extensions&#39;</span><span class=p>,</span> {}<span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>let</span> <span class=nx>g</span>:<span class=nx>Lf_Extensions</span>.<span class=nx>task</span> <span class=p>=</span> {<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>            \ <span class=s1>&#39;source&#39;</span>: <span class=nx>string</span><span class=p>(</span><span class=k>function</span><span class=p>(</span><span class=s1>&#39;s:lf_task_source&#39;</span><span class=p>))</span>[<span class=m>10</span>:<span class=m>-3</span>]<span class=p>,</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>            \ <span class=s1>&#39;accept&#39;</span>: <span class=nx>string</span><span class=p>(</span><span class=k>function</span><span class=p>(</span><span class=s1>&#39;s:lf_task_accept&#39;</span><span class=p>))</span>[<span class=m>10</span>:<span class=m>-3</span>]<span class=p>,</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>            \ <span class=s1>&#39;get_digest&#39;</span>: <span class=nx>string</span><span class=p>(</span><span class=k>function</span><span class=p>(</span><span class=s1>&#39;s:lf_task_digest&#39;</span><span class=p>))</span>[<span class=m>10</span>:<span class=m>-3</span>]<span class=p>,</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>            \ <span class=s1>&#39;highlights_def&#39;</span>: {<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>            \     <span class=s1>&#39;Lf_hl_funcScope&#39;</span>: <span class=s1>&#39;^\S\+&#39;</span><span class=p>,</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>            \     <span class=s1>&#39;Lf_hl_funcDirname&#39;</span>: <span class=s1>&#39;^\S\+\s*\zs&lt;.*&gt;\ze\s*:&#39;</span><span class=p>,</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>            \ }<span class=p>,</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>            \ }<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>nnoremap</span> <span class=p>&lt;</span><span class=nx>silent</span><span class=p>&gt;&lt;</span><span class=nx>leader</span><span class=p>&gt;</span><span class=nx>T</span> :<span class=nx>Leaderf</span> <span class=nx>task</span><span class=p>&lt;</span><span class=nx>CR</span><span class=p>&gt;</span> <span class=c>&#34;&lt;leader&gt;T 模糊搜索任务</span><span class=err>
</span></span></span></code></pre></div><p><strong>Tips</strong>：使用 <a href=https://github.com/ryanoasis/nerd-fonts target=_blank rel="external nofollow noopener noreferrer">nerdfont<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a> 和 <a href=https://github.com/ryanoasis/vim-devicons target=_blank rel="external nofollow noopener noreferrer">vim-devicons<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a> 可以在 LeaderF、NERDtree 等插件中显示漂亮的文件图标。</p><h2 id=调试>调试</h2><p>调试一直是 Vim 的弱点，最近 <em>DAP</em>（<em>Debug Adapter Protocol</em>）的提出带来了一些改变。YouCompleteMe 的主要开发者 puremourning 创建了 <a href=https://github.com/puremourning/vimspector target=_blank rel="external nofollow noopener noreferrer">vimspector<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>，这是目前最强的 Vim 调试插件，仍处于开发阶段，您如果有兴趣的话可以参考我的博客 <a href=https://www.kongjun18.me/posts/vimspector-the-best-debug-plugin-for-vim target=_blank rel="external nofollow noopener noreferrer">Vim 最强调试插件：vimspector<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>。</p><h2 id=git>Git</h2><p>Tpope 的 <a href=https://github.com/tpope/vim-fugitive target=_blank rel="external nofollow noopener noreferrer">vim-fugitive<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a> 让 Git 工作流在 Vim 中顺畅无比，使用 <a href=https://github.com/airblade/vim-gitgutter target=_blank rel="external nofollow noopener noreferrer">vim-gitgutter<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a> 在侧边栏展示 Git 状态。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-vim data-lang=vim><span class=line><span class=cl><span class=nx>command</span><span class=p>!</span> <span class=p>-</span><span class=nx>bang</span> <span class=p>-</span><span class=nx>nargs</span><span class=p>=</span>* <span class=p>-</span><span class=nx>complete</span><span class=p>=</span><span class=nx>file</span> <span class=nx>Make</span> <span class=nx>AsyncRun</span> <span class=p>-</span><span class=nx>program</span><span class=p>=</span><span class=nx>make</span> @ <span class=p>&lt;</span><span class=nx>args</span><span class=p>&gt;</span> <span class=c>&#34; 异步 git push</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>&#34; git-gutter</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>let</span> <span class=nx>g</span>:<span class=nx>gitgutter_map_keys</span> <span class=p>=</span> <span class=m>0</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>nmap</span> <span class=nx>ghp</span> <span class=p>&lt;</span><span class=nx>Plug</span><span class=p>&gt;(</span><span class=nx>GitGutterPreviewHunk</span><span class=p>)</span> <span class=c>&#34; 预览修改（diff）</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>nmap</span> <span class=nx>ghs</span> <span class=p>&lt;</span><span class=nx>Plug</span><span class=p>&gt;(</span><span class=nx>GitGutterStageHunk</span><span class=p>)</span>   <span class=c>&#34; 暂存修改</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>nmap</span> <span class=nx>ghu</span> <span class=p>&lt;</span><span class=nx>Plug</span><span class=p>&gt;(</span><span class=nx>GitGutterUndoHunk</span><span class=p>)</span>    <span class=c>&#34; 丢弃修改</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>nmap</span> [<span class=nx>c</span> <span class=p>&lt;</span><span class=nx>Plug</span><span class=p>&gt;(</span><span class=nx>GitGutterPrevHunk</span><span class=p>)</span>     <span class=c>&#34; 上一处修改</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nx>nmap</span> ]<span class=nx>c</span> <span class=p>&lt;</span><span class=nx>Plug</span><span class=p>&gt;(</span><span class=nx>GitGutterNextHunk</span><span class=p>)</span>     <span class=c>&#34; 下一处修改</span><span class=err>
</span></span></span></code></pre></div><p><strong>Tip</strong>：vim-fugitve 还可以用来处理 git conflict，这里不介绍。</p><h2 id=格式化>格式化</h2><p>注释请使用 <a href=https://github.com/Chiel92/vim-autoformat target=_blank rel="external nofollow noopener noreferrer">vim-format<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>，它易于拓展，可以支持所有文件类型。vim-format 会根据文件类型执行对应的格式化命令，C/C++ 默认使用 clang-format，所以您只需要将 .clang-format 放到项目根目录即可。</p><p>定义一个快捷键快速格式化代码。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-vim data-lang=vim><span class=line><span class=cl><span class=nx>nnoremap</span> <span class=p>&lt;</span><span class=nx>Leader</span><span class=p>&gt;</span><span class=nx>bf</span> :<span class=nx>Autoformat</span><span class=p>&lt;</span><span class=nx>CR</span><span class=p>&gt;</span><span class=err>
</span></span></span></code></pre></div><p><strong>Tip</strong>：您还可以利用<em>自动命令</em>在写入文件时自动格式化，利用<em>替换命令</em>在写入文件时自动清除行尾空白。</p><h2 id=注释>注释</h2><p>目前最流行的注释/反注释是 <a href=https://github.com/preservim/nerdcommenter target=_blank rel="external nofollow noopener noreferrer">nerdcommenter<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a> 和 <a href=https://github.com/tpope/vim-commentary target=_blank rel="external nofollow noopener noreferrer">vim-commentary<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>。nerdcommenter 相比于 vim-commentary 功能更强，拓展性更好，因此推荐使用 nerdcommenter。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-vim data-lang=vim><span class=line><span class=cl><span class=c>&#34; Add spaces after comment delimiters by default</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>let</span> <span class=nx>g</span>:<span class=nx>NERDSpaceDelims</span> <span class=p>=</span> <span class=m>1</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>
</span></span></span><span class=line><span class=cl><span class=c>&#34; Align line-wise comment delimiters both sides</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>let</span> <span class=nx>g</span>:<span class=nx>NERDDefaultAlign</span> <span class=p>=</span> <span class=s1>&#39;both&#39;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>
</span></span></span><span class=line><span class=cl><span class=c>&#34; Allow commenting and inverting empty lines (useful when commenting a region)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>let</span> <span class=nx>g</span>:<span class=nx>NERDCommentEmptyLines</span> <span class=p>=</span> <span class=m>1</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>
</span></span></span><span class=line><span class=cl><span class=c>&#34; Enable trimming of trailing whitespace when uncommenting</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>let</span> <span class=nx>g</span>:<span class=nx>NERDTrimTrailingWhitespace</span> <span class=p>=</span> <span class=m>1</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>
</span></span></span><span class=line><span class=cl><span class=c>&#34; Enable NERDCommenterToggle to check all selected lines is commented or not</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>let</span> <span class=nx>g</span>:<span class=nx>NERDToggleCheckAllLines</span> <span class=p>=</span> <span class=m>1</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>
</span></span></span><span class=line><span class=cl><span class=c>&#34; Usefull when comment argument</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>let</span> <span class=nx>g</span>:<span class=nx>NERDAllowAnyVisualDelims</span> <span class=p>=</span> <span class=m>0</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>let</span> <span class=nx>g</span>:<span class=nx>NERDAltDelims_asm</span> <span class=p>=</span> <span class=m>1</span><span class=err>
</span></span></span></code></pre></div><p>nerdcommenter 默认的快捷键请参考文档。请不要再蜗牛一样地用<code>:help</code>命令查看文档，用<code>&lt;Leader>h</code>模糊搜索！</p><p><strong>Tip</strong>：您会发现注释/反注释后光标仍停留在原来的位置，如果您希望光标停留在可视区域结尾，可以添加上以下代码：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-vim data-lang=vim><span class=line><span class=cl><span class=k>let</span> <span class=nx>g</span>:<span class=nx>NERDCreateDefaultMappings</span> <span class=p>=</span> <span class=m>0</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>
</span></span></span><span class=line><span class=cl><span class=c>&#34; It is impossible to determine execute mode in hooks. Thus, I wrap raw NERDComment()</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>&#34; to pass mode infomation to hooks and create mappings manually.</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>&#34; NERDCommenterAltDelims is not wrapped and it would execute hooks. So I</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>&#34; delete variable g:NERDCommenter_mode in NERDCommenter_after() to disable</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>&#34; hooks executed by NERDCommenterAltDelims</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>function</span><span class=p>!</span> <span class=nx>s</span>:<span class=nx>NERDCommenter_wrapper</span><span class=p>(</span><span class=nx>mode</span><span class=p>,</span> <span class=nx>type</span><span class=p>)</span> <span class=nx>range</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=k>let</span> <span class=nx>g</span>:<span class=nx>NERDCommenter_mode</span> <span class=p>=</span> <span class=nx>a</span>:<span class=nx>mode</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=nx>execute</span> <span class=nx>a</span>:<span class=nx>firstline</span> .. <span class=s1>&#39;,&#39;</span>  .. <span class=nx>a</span>:<span class=nx>lastline</span> <span class=s1>&#39;call NERDComment(&#39;</span> .. <span class=nx>string</span><span class=p>(</span><span class=nx>a</span>:<span class=nx>mode</span><span class=p>)</span> .. <span class=s1>&#39;,&#39;</span> .. <span class=nx>string</span><span class=p>(</span><span class=nx>a</span>:<span class=nx>type</span><span class=p>)</span> .. <span class=s1>&#39;)&#39;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>endfunction</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>
</span></span></span><span class=line><span class=cl><span class=c>&#34; modes: a list of mode(n - normal, x - visual)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>function</span><span class=p>!</span> <span class=nx>s</span>:<span class=nx>create_commenter_mapping</span><span class=p>(</span><span class=nx>modes</span><span class=p>,</span> <span class=nx>map</span><span class=p>,</span> <span class=nx>type</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=nx>for</span> <span class=nx>l</span>:<span class=nx>mode</span> <span class=nx>in</span> <span class=nx>split</span><span class=p>(</span><span class=nx>a</span>:<span class=nx>modes</span><span class=p>,</span> <span class=s1>&#39;\zs&#39;</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>        <span class=nx>execute</span> <span class=nx>l</span>:<span class=nx>mode</span> .. <span class=s1>&#39;noremap &lt;silent&gt; &lt;Leader&gt;&#39;</span> .. <span class=nx>a</span>:<span class=nx>map</span> .. <span class=s1>&#39; :call &lt;SID&gt;NERDCommenter_wrapper(&#39;</span> .. <span class=nx>string</span><span class=p>(</span><span class=nx>l</span>:<span class=nx>mode</span><span class=p>)</span> .. <span class=s1>&#39;, &#39;</span> .. <span class=nx>string</span><span class=p>(</span><span class=nx>a</span>:<span class=nx>type</span><span class=p>)</span> .. <span class=s1>&#39;)&lt;CR&gt;&#39;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=nx>endfor</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>endfunction</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>function</span><span class=p>!</span> <span class=nx>CreateCommenterMappings</span><span class=p>()</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>    &#34; All mappings are equal to standard NERDCommenter mappings.</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=nx>call</span> <span class=nx>s</span>:<span class=nx>create_commenter_mapping</span><span class=p>(</span><span class=s1>&#39;nx&#39;</span><span class=p>,</span> <span class=s1>&#39;cc&#39;</span><span class=p>,</span> <span class=s1>&#39;Comment&#39;</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=nx>call</span> <span class=nx>s</span>:<span class=nx>create_commenter_mapping</span><span class=p>(</span><span class=s1>&#39;nx&#39;</span><span class=p>,</span> <span class=s1>&#39;cu&#39;</span><span class=p>,</span> <span class=s1>&#39;Uncomment&#39;</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=nx>call</span> <span class=nx>s</span>:<span class=nx>create_commenter_mapping</span><span class=p>(</span><span class=s1>&#39;n&#39;</span><span class=p>,</span> <span class=s1>&#39;cA&#39;</span><span class=p>,</span> <span class=s1>&#39;Append&#39;</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=nx>call</span> <span class=nx>s</span>:<span class=nx>create_commenter_mapping</span><span class=p>(</span><span class=s1>&#39;nx&#39;</span><span class=p>,</span> <span class=s1>&#39;c&lt;space&gt;&#39;</span><span class=p>,</span> <span class=s1>&#39;Toggle&#39;</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=nx>call</span> <span class=nx>s</span>:<span class=nx>create_commenter_mapping</span><span class=p>(</span><span class=s1>&#39;nx&#39;</span><span class=p>,</span> <span class=s1>&#39;cm&#39;</span><span class=p>,</span> <span class=s1>&#39;Minimal&#39;</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=nx>call</span> <span class=nx>s</span>:<span class=nx>create_commenter_mapping</span><span class=p>(</span><span class=s1>&#39;nx&#39;</span><span class=p>,</span> <span class=s1>&#39;cn&#39;</span><span class=p>,</span> <span class=s1>&#39;Nested&#39;</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=nx>call</span> <span class=nx>s</span>:<span class=nx>create_commenter_mapping</span><span class=p>(</span><span class=s1>&#39;n&#39;</span><span class=p>,</span> <span class=s1>&#39;c$&#39;</span><span class=p>,</span>  <span class=s1>&#39;ToEOL&#39;</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=nx>call</span> <span class=nx>s</span>:<span class=nx>create_commenter_mapping</span><span class=p>(</span><span class=s1>&#39;nx&#39;</span><span class=p>,</span> <span class=s1>&#39;ci&#39;</span><span class=p>,</span> <span class=s1>&#39;Invert&#39;</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=nx>call</span> <span class=nx>s</span>:<span class=nx>create_commenter_mapping</span><span class=p>(</span><span class=s1>&#39;nx&#39;</span><span class=p>,</span> <span class=s1>&#39;cs&#39;</span><span class=p>,</span> <span class=s1>&#39;Sexy&#39;</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=nx>call</span> <span class=nx>s</span>:<span class=nx>create_commenter_mapping</span><span class=p>(</span><span class=s1>&#39;nx&#39;</span><span class=p>,</span> <span class=s1>&#39;cy&#39;</span><span class=p>,</span> <span class=s1>&#39;Yank&#39;</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=nx>call</span> <span class=nx>s</span>:<span class=nx>create_commenter_mapping</span><span class=p>(</span><span class=s1>&#39;n&#39;</span><span class=p>,</span> <span class=s1>&#39;cA&#39;</span><span class=p>,</span>  <span class=s1>&#39;Append&#39;</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=nx>call</span> <span class=nx>s</span>:<span class=nx>create_commenter_mapping</span><span class=p>(</span><span class=s1>&#39;nx&#39;</span><span class=p>,</span> <span class=s1>&#39;cl&#39;</span><span class=p>,</span> <span class=s1>&#39;AlignLeft&#39;</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=nx>call</span> <span class=nx>s</span>:<span class=nx>create_commenter_mapping</span><span class=p>(</span><span class=s1>&#39;nx&#39;</span><span class=p>,</span> <span class=s1>&#39;cb&#39;</span><span class=p>,</span> <span class=s1>&#39;AlignBoth&#39;</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=nx>call</span> <span class=nx>s</span>:<span class=nx>create_commenter_mapping</span><span class=p>(</span><span class=s1>&#39;nx&#39;</span><span class=p>,</span> <span class=s1>&#39;cu&#39;</span><span class=p>,</span> <span class=s1>&#39;Uncomment&#39;</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=nx>call</span> <span class=nx>s</span>:<span class=nx>create_commenter_mapping</span><span class=p>(</span><span class=s1>&#39;n&#39;</span><span class=p>,</span> <span class=s1>&#39;ca&#39;</span><span class=p>,</span>  <span class=s1>&#39;AltDelims&#39;</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=nx>nmap</span> <span class=p>&lt;</span><span class=nx>leader</span><span class=p>&gt;</span><span class=nx>ca</span> <span class=p>&lt;</span><span class=nx>plug</span><span class=p>&gt;</span><span class=nx>NERDCommenterAltDelims</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>endfunction</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>
</span></span></span><span class=line><span class=cl><span class=c>&#34; NERDCommenter hooks</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>function</span><span class=p>!</span> <span class=nx>NERDCommenter_before</span><span class=p>()</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=k>let</span> <span class=nx>g</span>:<span class=nx>nerdcommmenter_visual_flag</span> <span class=p>=</span> <span class=nx>v</span>:<span class=nx>false</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=k>if</span> <span class=nx>get</span><span class=p>(</span><span class=nx>g</span>:<span class=p>,</span> <span class=s1>&#39;NERDCommenter_mode&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span> <span class=p>=~</span># <span class=s1>&#39;[vsx]&#39;</span>    <span class=c>&#34; executed in visual mode</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>        <span class=k>let</span> <span class=nx>l</span>:<span class=nx>marklist</span> <span class=p>=</span> <span class=nx>getmarklist</span><span class=p>(</span><span class=s1>&#39;%&#39;</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>        <span class=nx>for</span> <span class=nx>l</span>:<span class=nx>mark</span> <span class=nx>in</span> <span class=nx>l</span>:<span class=nx>marklist</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>            <span class=k>if</span> <span class=nx>l</span>:<span class=nx>mark</span>[<span class=s1>&#39;mark&#39;</span>] <span class=p>=~</span> <span class=s2>&#34;&#39;&gt;&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>                <span class=k>let</span> <span class=nx>g</span>:<span class=nx>nerdcommmenter_cursor</span> <span class=p>=</span> <span class=nx>l</span>:<span class=nx>mark</span>.<span class=nx>pos</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>                <span class=k>let</span> <span class=nx>g</span>:<span class=nx>nerdcommmenter_visual_flag</span> <span class=p>=</span> <span class=nx>v</span>:<span class=nx>true</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>                <span class=nx>break</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>            <span class=k>endif</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>        <span class=nx>endfor</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=k>endif</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>endfunction</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>function</span><span class=p>!</span> <span class=nx>NERDCommenter_after</span><span class=p>()</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=k>if</span> <span class=nx>g</span>:<span class=nx>nerdcommmenter_visual_flag</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>        <span class=nx>call</span> <span class=nx>setpos</span><span class=p>(</span><span class=s1>&#39;.&#39;</span><span class=p>,</span> <span class=nx>g</span>:<span class=nx>nerdcommmenter_cursor</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=k>endif</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=k>let</span> <span class=nx>g</span>:<span class=nx>nerdcommmenter_visual_flag</span> <span class=p>=</span> <span class=nx>v</span>:<span class=nx>false</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=nx>unlet</span><span class=p>!</span> <span class=nx>g</span>:<span class=nx>NERDCommenter_mode</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>endfunction</span><span class=err>
</span></span></span></code></pre></div><p><figure><img src=images/nerdcommenter.gif alt=nerdcommenter><figcaption>nerdcommenter</figcaption></figure></p><h2 id=结语>结语</h2><p>本文介绍了用 Vim 搭建开发环境的思路，但 Vim 的魅力不在于“千篇一律”，而在于“各不相同”，每个 Vimmer 都有自己的 Vim，根据自己的习惯不断改进工作流。总之，希望本文可以帮助大家走进 Vim 的世界。</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="更新于 2021-03-15 14:53:02">更新于 2021-03-15&nbsp;</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=/posts/2021/03/15/ data-title="用 Vim 搭建开发环境" data-hashtags=Vim><i class="fa-brands fa-twitter fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=/posts/2021/03/15/ data-hashtag=Vim><i class="fa-brands fa-facebook-square fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=/posts/2021/03/15/ data-title="用 Vim 搭建开发环境"><i class="fa-brands fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/vim/ class=post-tag>Vim</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/2020/05/05/ class=post-nav-item rel=prev title="Vimspector: 最强 Vim 调试插件"><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>Vimspector: 最强 Vim 调试插件</a>
<a href=/posts/2021/04/28/ class=post-nav-item rel=next title="UNIX 进程关系">UNIX 进程关系<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div class=post-reward><div class=comment></div><input type=checkbox class=reward-input name=reward id=fi-reward hidden>
<label class=reward-button for=fi-reward>赞赏</label><div class=reward-ways data-mode=static><div><img loading=lazy src=/alipay.jpg srcset="/alipay.jpg, /alipay.jpg 1.5x, /alipay.jpg 2x" sizes=auto data-title="孔俊 支付宝" data-alt="孔俊 支付宝" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span>支付宝</span></div><div><img loading=lazy src=/wechatpay.png srcset="/wechatpay.png, /wechatpay.png 1.5x, /wechatpay.png 2x" sizes=auto data-title="孔俊 微信" data-alt="孔俊 微信" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span>微信</span></div></div></div><div id=comments><div id=giscus><script src=https://giscus.app/client.js data-repo=kongjun18/kongjun18.github.io data-repo-id=R_kgDOICeqmQ data-category=Announcements data-category-id=DIC_kwDOICeqmc4CVeTb data-mapping=pathname data-strict=0 data-theme=preferred_color_scheme data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-lang=zh-CN data-loading=lazy crossorigin=anonymous async defer></script></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://giscus.app/ rel="external nofollow noopener noreferrer">giscus</a>.</noscript></div></article></main><footer class=footer><div class=footer-container><div class="footer-line powered">由 <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreferrer" title="Hugo 0.110.0">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/hugo-fixit/FixIt target=_blank rel=external title="FixIt v0.2.18"><img class=fixit-icon src=/fixit.min.svg alt="FixIt logo">&nbsp;FixIt</a></div><div class="footer-line copyright" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2022 - 2023</span><span class=author itemprop=copyrightHolder>
<a href=/></a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div><div class="footer-line statistics"></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label=回到顶部><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class="variant-numeric d-none">0%</span></div><div class="fixed-button view-comments d-none" role=button aria-label=查看评论><i class="fa-solid fa-comment fa-fw" aria-hidden=true></i></div></div><a href=https://github.com/kongjun18/blog title=查看博客源代码 target=_blank rel="external nofollow" class="github-corner left d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div id=mask></div><noscript><div class=noscript-warning>FixIt 主题在启用 JavaScript 的情况下效果最佳。</div></noscript></div><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><script src=/lib/sharer/sharer.min.js async defer></script><script src=/lib/cookieconsent/cookieconsent.min.js defer></script><script src=/lib/pangu/pangu.min.js defer></script><script>window.config={autoBookmark:!0,code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:40},comment:{enable:!0,expired:!1,giscus:{darkTheme:"dark_dimmed",lightTheme:"light"}},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验。"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},pangu:{enable:!0,selector:"article"}}</script><script src=/js/theme.min.js defer></script></body></html>